version: 0.2
phases:
  build:
    commands:
      - echo "*** DOWNLOAD THEME"
      - git clone https://github.com/smyleeface/hugo_theme_beg.git themes/beg
      - echo "*** BUILD PRODUCTION"
      - hugo --theme beg --baseURL http://smylee.com/
      - ls -la ${CODEBUILD_SRC_DIR}
      - pwd
  post_build:
    commands:
      - echo "*** EMPTY S3 PRODUCTION BUCKET"
      - aws s3 rm s3://smylee.com --recursive

      # publishes to: https://s3-us-west-2.amazonaws.com/smylee.com/CodeBuildArtifacts/*
      - echo "*** PUBLISHING TO S3 PRODUCTION BUCKET"
      - aws s3 cp ${CODEBUILD_SRC_DIR}/public s3://smylee.com --recursive

#NOTE: Cannot use the `artifacts` section
# it works ok, in CodeBuild
# but is ignored when CodeBuild is used in CodePipeline
#artifacts:
#  files:
#    - '**/*'
#  base-directory: ${CODEBUILD_SRC_DIR}/public
